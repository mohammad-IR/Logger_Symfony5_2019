{% extends 'Doshbord.html.twig' %}
{% block title %}
    داشبورد
{% endblock %}

                    {% set i = 1 %}
                    {% set limit = 0 %}
{% block built %}
    <div data-kt-menu-trigger="click" id="package_scrole" class="menu-item menu-accordion">
									<span class="menu-link">
										<span class="menu-icon">
											<!--begin::Svg Icon | path: icons/duotone/Shopping/Box2.svg-->
											<span class="svg-icon svg-icon-2">
												<svg xmlns="http://www.w3.org/2000/svg"
                                                     xmlns:xlink="http://www.w3.org/1999/xlink" width="24px"
                                                     height="24px" viewBox="0 0 24 24" version="1.1">
													<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
														<rect x="0" y="0" width="24" height="24"/>
														<path d="M4,9.67471899 L10.880262,13.6470401 C10.9543486,13.689814 11.0320333,13.7207107 11.1111111,13.740321 L11.1111111,21.4444444 L4.49070127,17.526473 C4.18655139,17.3464765 4,17.0193034 4,16.6658832 L4,9.67471899 Z M20,9.56911707 L20,16.6658832 C20,17.0193034 19.8134486,17.3464765 19.5092987,17.526473 L12.8888889,21.4444444 L12.8888889,13.6728275 C12.9050191,13.6647696 12.9210067,13.6561758 12.9368301,13.6470401 L20,9.56911707 Z"
                                                              fill="#000000"/>
														<path d="M4.21611835,7.74669402 C4.30015839,7.64056877 4.40623188,7.55087574 4.5299008,7.48500698 L11.5299008,3.75665466 C11.8237589,3.60013944 12.1762411,3.60013944 12.4700992,3.75665466 L19.4700992,7.48500698 C19.5654307,7.53578262 19.6503066,7.60071528 19.7226939,7.67641889 L12.0479413,12.1074394 C11.9974761,12.1365754 11.9509488,12.1699127 11.9085461,12.2067543 C11.8661433,12.1699127 11.819616,12.1365754 11.7691509,12.1074394 L4.21611835,7.74669402 Z"
                                                              fill="#000000" opacity="0.3"/>
													</g>
												</svg>
											</span>
                                            <!--end::Svg Icon-->
										</span>
										<span class="menu-title">پکیج ها</span>
										<span class="menu-arrow"></span>
									</span>
        <div class="menu-sub menu-sub-accordion menu-active-bg">
            <div class="menu-item">
                <a class="menu-link" id="list_package" href="{{ path('list_packages') }}">
												<span class="menu-bullet">
													<span class="bullet bullet-dot"></span>
												</span>
                    <span class="menu-title">لیست پکیج ها</span>
                </a>
            </div>
            {% if is_granted("ROLE_ADMIN") %}
                <div class="menu-item">
                    <a class="menu-link" id="add_package" href="{{ path('add_packages') }}">
												<span class="menu-bullet">
													<span class="bullet bullet-dot"></span>
												</span>
                        <span class="menu-title">اضافه کردن </span>
                    </a>
                </div>
            {% endif %}
            <div class="menu-item">
                <a class="menu-link" id="buy_package" href="{{ path('buy_package') }}">
												<span class="menu-bullet">
													<span class="bullet bullet-dot"></span>
												</span>
                    <span class="menu-title">خرید پکیج</span>
                </a>
            </div>
            <div class="menu-item">
                <a class="menu-link" id="bought_package" href="{{ path('bought_package') }}">
												<span class="menu-bullet">
													<span class="bullet bullet-dot"></span>
												</span>
                    <span class="menu-title">لیست اپلیکیشن های خریداری شده</span>
                </a>
            </div>
        </div>
    </div>


    <div data-kt-menu-trigger="click" id="Applications_scrole" class="menu-item menu-accordion">
									<span class="menu-link">
										<span class="menu-icon">
											<!--begin::Svg Icon | path: icons/duotone/Shopping/Box2.svg-->
											<span class="svg-icon svg-icon-2">
												<svg xmlns="http://www.w3.org/2000/svg"
                                                     xmlns:xlink="http://www.w3.org/1999/xlink" width="24px"
                                                     height="24px" viewBox="0 0 24 24" version="1.1">
													<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
														<rect x="0" y="0" width="24" height="24"/>
														<path d="M4,9.67471899 L10.880262,13.6470401 C10.9543486,13.689814 11.0320333,13.7207107 11.1111111,13.740321 L11.1111111,21.4444444 L4.49070127,17.526473 C4.18655139,17.3464765 4,17.0193034 4,16.6658832 L4,9.67471899 Z M20,9.56911707 L20,16.6658832 C20,17.0193034 19.8134486,17.3464765 19.5092987,17.526473 L12.8888889,21.4444444 L12.8888889,13.6728275 C12.9050191,13.6647696 12.9210067,13.6561758 12.9368301,13.6470401 L20,9.56911707 Z"
                                                              fill="#000000"/>
														<path d="M4.21611835,7.74669402 C4.30015839,7.64056877 4.40623188,7.55087574 4.5299008,7.48500698 L11.5299008,3.75665466 C11.8237589,3.60013944 12.1762411,3.60013944 12.4700992,3.75665466 L19.4700992,7.48500698 C19.5654307,7.53578262 19.6503066,7.60071528 19.7226939,7.67641889 L12.0479413,12.1074394 C11.9974761,12.1365754 11.9509488,12.1699127 11.9085461,12.2067543 C11.8661433,12.1699127 11.819616,12.1365754 11.7691509,12.1074394 L4.21611835,7.74669402 Z"
                                                              fill="#000000" opacity="0.3"/>
													</g>
												</svg>
											</span>
                                            <!--end::Svg Icon-->
										</span>
										<span class="menu-title">اپلیکیشن ها</span>
										<span class="menu-arrow"></span>
									</span>
        <div class="menu-sub menu-sub-accordion menu-active-bg">
            <div class="menu-item">
                <a class="menu-link" id="list_Applications" href="{{ path('list_app') }}">
												<span class="menu-bullet">
													<span class="bullet bullet-dot"></span>
												</span>
                    <span class="menu-title">لیست اپلیکیشن ها</span>
                </a>
            </div>
            <div class="menu-item">
                <a class="menu-link" id="add_application" href="{{ path('add_app') }}">
												<span class="menu-bullet">
                                                    <span class="bullet bullet-dot"></span>
												</span>
                    <span class="menu-title">افزودن</span>
                </a>
            </div>
        </div>
    </div>


    {% if is_granted("ROLE_ADMIN") %}
        <div data-kt-menu-trigger="click" id="article_scrole" class="menu-item menu-accordion">
									<span class="menu-link">
										<span class="menu-icon">
											<!--begin::Svg Icon | path: icons/duotone/Shopping/Box2.svg-->
											<span class="svg-icon svg-icon-2">
												<svg xmlns="http://www.w3.org/2000/svg"
                                                     xmlns:xlink="http://www.w3.org/1999/xlink" width="24px"
                                                     height="24px" viewBox="0 0 24 24" version="1.1">
													<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
														<rect x="0" y="0" width="24" height="24"/>
														<path d="M4,9.67471899 L10.880262,13.6470401 C10.9543486,13.689814 11.0320333,13.7207107 11.1111111,13.740321 L11.1111111,21.4444444 L4.49070127,17.526473 C4.18655139,17.3464765 4,17.0193034 4,16.6658832 L4,9.67471899 Z M20,9.56911707 L20,16.6658832 C20,17.0193034 19.8134486,17.3464765 19.5092987,17.526473 L12.8888889,21.4444444 L12.8888889,13.6728275 C12.9050191,13.6647696 12.9210067,13.6561758 12.9368301,13.6470401 L20,9.56911707 Z"
                                                              fill="#000000"/>
														<path d="M4.21611835,7.74669402 C4.30015839,7.64056877 4.40623188,7.55087574 4.5299008,7.48500698 L11.5299008,3.75665466 C11.8237589,3.60013944 12.1762411,3.60013944 12.4700992,3.75665466 L19.4700992,7.48500698 C19.5654307,7.53578262 19.6503066,7.60071528 19.7226939,7.67641889 L12.0479413,12.1074394 C11.9974761,12.1365754 11.9509488,12.1699127 11.9085461,12.2067543 C11.8661433,12.1699127 11.819616,12.1365754 11.7691509,12.1074394 L4.21611835,7.74669402 Z"
                                                              fill="#000000" opacity="0.3"/>
													</g>
												</svg>
											</span>
                                            <!--end::Svg Icon-->
										</span>
										<span class="menu-title">مقالات</span>
										<span class="menu-arrow"></span>
									</span>
            <div class="menu-sub menu-sub-accordion menu-active-bg">
                <div class="menu-item">
                    <a class="menu-link" id="list_artticle" href="{{ path('list_article') }}">
												<span class="menu-bullet">
													<span class="bullet bullet-dot"></span>
												</span>
                        <span class="menu-title">لیست مقالات</span>
                    </a>
                </div>
                <div class="menu-item">
                    <a class="menu-link" id="add_article" href="{{ path('add_article') }}">
												<span class="menu-bullet">
													<span class="bullet bullet-dot"></span>
												</span>
                        <span class="menu-title">اضافه کردن مقاله </span>
                    </a>
                </div>
                <div class="menu-item">
                    <a class="menu-link" id="list_category" href="{{ path('list_category') }}">
												<span class="menu-bullet">
													<span class="bullet bullet-dot"></span>
												</span>
                        <span class="menu-title">لیست دسته بندی ها</span>
                    </a>
                </div>
                <div class="menu-item">
                    <a class="menu-link" id="add_category" href="{{ path('add_category') }}">
												<span class="menu-bullet">
													<span class="bullet bullet-dot"></span>
												</span>
                        <span class="menu-title">اضافه کردن دسته بندی </span>
                    </a>
                </div>
            </div>
        </div>

    {% endif %}

{% endblock %}
{% block main %}
    <div class="container">
        <div class="row ml-2 mr-4 justify-content-center">
            <div class="col-md-auto g-2 card text-center" style="width: 18rem;">

                <div class="card-body rounded-3 col border-light border-5 bg-light">
                    <h5 class="card-title border-top-5 border-info text-muted"><a
                                href="{{ path('Log_deatil_type', {'type': 'INFO'}) }}">خطا هایinfo</a></h5>
                    <hr>
                    <p class="mt-11 card-text">{{ INFO }}</p>
                </div>
            </div>
            <div class="col-md-auto g-2 card text-center" style="width: 18rem;">
                <div class="card-body rounded-3 col border-light border-5 bg-light">
                    <h5 class="card-title  border-info text-muted"><a
                                href="{{ path('Log_deatil_type', {'type': 'DANGER'}) }}">خطاهایdanger</a></h5>
                    <hr>
                    <p class="mt-11 card-text">{{ DANGER }}</p>
                </div>
            </div>
            <div class="col-md-auto g-2 card text-center" style="width: 18rem;">

                <div class="card-body rounded-3 col border-light border-5 bg-light">
                    <h5 class="card-title border-top-5 border-info text-muted"><a
                                href="{{ path('Log_deatil_type', {'type': 'ERROR'}) }}">خطاهای error</a></h5>
                    <hr>
                    <p class="mt-11 card-text">{{ ERROR }}</p>
                </div>
            </div>
            <div class="col-md-auto g-2  card text-center" style="width: 18rem;">

                <div class="card-body rounded-3 col border-light border-5 bg-light">
                    <h5 class="card-title border-top-5 border-info text-muted"><a
                                href="{{ path('Log_deatil_type', {'type': 'WARNING'}) }}">خطاهای warining</a></h5>
                    <hr class="bg-dark">
                    <p class="mt-11 card-text">{{ WARNING }}</p>
                </div>
            </div>
        </div>
        <br>
        <div class="row bg-light  justify-content-center g-5 rounded-3 border  border-dark ">
            <div class="col ">
                <table class="table gx-7 ">
                    <thead class="thead-dark border-gray-400 border-bottom-1">
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">نوع</th>
                        <th scope="col">توضیحات</th>
                        <th scope="col">نام اپ</th>
                    </tr>
                    </thead>
                    <tbody class="" id="tboby_logs">
                    {% for last_log  in last_logs|slice(0,10) %}
                        {% set limit = last_log.id %}
                        <tr>
                            <th scope="row">{{ i }}</th>
                            <td>
                                <a class="" data-bs-toggle="offcanvas" href="#offcanvasExample{{ last_log.id }}"
                                   role="button">
                                    {{ last_log.type }}
                                </a>
                                <div class="offcanvas offcanvas-start" tabindex="-1"
                                     id="offcanvasExample{{ last_log.id }}">
                                    <div class="offcanvas-header bg-light-success">
                                        <h5 class="offcanvas-title"
                                            id="offcanvasExampleLabel">{{ last_log.user.eraseCredentials }}</h5>
                                        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas"
                                                aria-label="Close"></button>
                                    </div>
                                    <hr>
                                    <div class="offcanvas-body bg-light">
                                        <div>
                                            <p class="rounded-2 btn-outline-primary"><span
                                                        class="text-dark btn-outline-primary fw-bold">نوع لاگ: </span>{{ last_log.type }}
                                                <span class="text-muted"></span></p>
                                            <p class="rounded-2 btn-outline-primary"><span
                                                        class="text-dark btn-outline-primary fw-bold">نام اپلیکیشن : </span>{{ last_log.app.name }}
                                                <span class="text-muted"></span></p>
                                            <p class="rounded-2 btn-outline-primary"><span
                                                        class="text-dark btn-outline-primary fw-bold">تاریخ ثبت لاگ : </span>{{ last_log.date|date("Y/m/d,  h:m:s") }}
                                                <span class="text-muted"></span></p>
                                            <p class="rounded-2 btn-outline-primary"><span
                                                        class="text-dark btn-outline-primary fw-bold">توضیحات لاگ : </span>{{ last_log.description }}
                                                <span class="text-muted"></span></p>
                                            <p class="rounded-2 btn-outline-primary"><span class="text-dark fw-bold">پارامتر های لاگ :</span>{
                                                {% for key,parameter in last_log.parameters %}
                                                    <span class="text-muted">{{ key }}:{{ parameter }}, </span>
                                                {% endfor %}
                                                }</p>
                                        </div>
                                    </div>
                                </div>
                            </td>
                            <td>{{ last_log.description }}</td>
                            <td>{{ last_log.app.name }}</td>
                        </tr>
                        {% set i = i + 1 %}
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        <div class="row gy-4 mt-5" id="more_log_div">
            <div class="col-auto">
                <button class="btn-outline-dark btn-primary rounded-3  p-3 g-5" id="more_log">بیشتر</button>
            </div>
        </div>
        <div class="row me-2 ms-4 mt-5 justify-content-center">
            <div class="col-md-auto g-3 card text-center" style="width: 18rem;">

                <div class="card-body rounded-3 col border-light border-5 bg-light">
                    <h5 class="card-title border-top-5 border-info text-muted">مجموعه لاگ های ثبت شده</h5>
                    <hr>
                    <p class="mt-11 card-text">{{ total_logs }}</p>
                </div>
            </div>
            <div class="col-md-auto g-3  card text-center" style="width: 18rem;">
                <div class="card-body rounded-3 col border-light border-5 bg-light">
                    <h5 class="card-title  border-info text-muted">مجموعه لاگ های هفته اخیر</h5>
                    <hr>
                    <p class="mt-11 card-text">{{ log_week_ago }}</p>
                </div>
            </div>
            <div class="col-md-auto g-3 card text-center" style="width: 18rem;">

                <div class="card-body rounded-3 col border-light border-5 bg-light">
                    <h5 class="card-title border-top-5 border-info text-muted">مجموعه لاگ های ماه اخیر</h5>
                    <hr>
                    <p class="mt-11 card-text">{{ log_month_ago }}</p>
                </div>
            </div>
        </div>

        <div class="row m-10">

        </div>
    </div>
    <div id="nameMohammad"></div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script language="JavaScript">
        $(document).ready(function () {
            $('#more_log').click(function () {
                $.post('{{ (path('getLogs')) }}', {id: '{{ limit }}'}, function (data) {
                    if (data.length <= 1) {
                        document.getElementById('more_log_div').style.display = 'none';
                        console.log(data)
                    } else {
                        for (i = 0; i < data.length; i++) {
                            var e = $('<tr>' +
                                '<th scope="row">' +
                                (data[0]['number_log'] * 10 + i + 1) +
                                '</th><td>'
                                + '<a class="" data-bs-toggle="offcanvas" href="#offcanvasExample' + data[i]['id'] + '" role="button">' + data[i]['type'] + '</a>' +
                                '<div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasExample' + data[i]['id'] + '">' +
                                '<div class="offcanvas-header bg-light-success"><h5 class="offcanvas-title"id="offcanvasExampleLabel"> ' +
                                '</h5><button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas"' +
                                'aria-label="Close"></button></div><hr>' +
                                +'<div class="offcanvas-body bg-light"><div>' +
                                '<p class="rounded-2 btn-outline-primary"><span class="text-dark btn-outline-primary fw-bold">نوع لاگ: </span>' + data[i]['type'] +
                                '<span class="text-muted"></span></p>' +
                                '<p class="rounded-2 btn-outline-primary"><span class="text-dark btn-outline-primary fw-bold">نام اپلیکیشن : </span>' + data[i]['name_app'] +
                                '<span class="text-muted"></span></p><p class="rounded-2 btn-outline-primary"><span class="text-dark btn-outline-primary fw-bold">تاریخ ثبت لاگ : </span>' + data[i]['date'] +
                                '<span class="text-muted"></span></p>' +
                                '<p class="rounded-2 btn-outline-primary"><span class="text-dark btn-outline-primary fw-bold">توضیحات لاگ : </span>' + data[i]['description'] +
                                '<span class="text-muted"></span></p>' +
                                '<p class="rounded-2 btn-outline-primary"><span class="text-dark fw-bold">پارامتر های لاگ :</span>{' + '<span class="text-muted">' + data[i]['parameters'] + '</span>' + '}'
                                + '</p></div></div></div>' +
                                '</td><td>' + data[i]['description'] + '</td><td>' + data[i]['name_app'] + '</td></tr>');
                            $('#tboby_logs').append(e);
                        }
                    }
                });
            });
        });
    </script>
{% endblock %}
